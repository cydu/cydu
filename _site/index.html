
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Cydu &raquo; Hello World!</title>
    
    <meta name="author" content="杜传赢 ChuanyingDu">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/twitter/css/master.css?body=1" rel="stylesheet" type="text/css" media="all">

    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->
  </head>

  <body>

    <div class="navbar">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="/">Cydu's Blog</a>
          <ul class="nav">
            
            
            


  
    
      
      	
      	<li><a href="/about.html">About</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/categories.html">Categories</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/pages.html">Pages</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags.html">Tags</a></li>
      	
      
    
  



          </ul>
        </div>
      </div>
    </div>

    <div class="container">

      <div class="content">
        <div>
    <a href='feed://blog.cydu.net/atom.xml' class='right'>
    <img src='img/feed-icon-28x28.png' border='0' title='Chuanying Du&apos;s Feed' /></a>
<h1>Articles</h1>
</div><ul class='posts'>
    
        <div class='post'>
            <div class='title'><a href='/2012/09/weibo-counter-service-design-2.html'>[微架构设计]微博计数器的设计(下)</a></div>
            <div class='date'>September 09, 2012 &nbsp &nbsp 
                
                    <a href='/tags.html#tag_计数器'>计数器</a> &nbsp 
                
                    <a href='/tags.html#tag_微架构设计'>微架构设计</a> &nbsp 
                
                    <a href='/tags.html#tag_微博平台架构'>微博平台架构</a> &nbsp 
                
            </div>
            <div class='extract'>更新 Update: 更新了数据持久化和一致性保证相关的内容，多谢 @lihan_harry @郑环Zheng @51刘达 等同学的提醒。 Update2: 更新了 对于weibo_id key的优化，使用前缀压缩，可以节省近一半的空间。 感谢 @吴廷彬 @drdrxp 的建议！ Update3: 更新了 对于value 使用二维数组，多列进行压缩编码的优化思路， 再次感谢 @吴廷彬 的建议， Update4: 更新Redis方案下内存使用的估算, 感谢 @刘浩bupt 的提醒。 背景 上周挖了一个坑 微架构设计 微博计数器的设计(上). 虽然挖这个坑的动机是很不纯的(很明显的招聘软文, 非常欣慰的是确实收到了不少靠谱的简历, 希望简历来得更猛烈一些! ), 但是和大家讨论的过程中，还是收获很大的, 也认识了不少新朋友。 对于一个简单的计数服务来说，确实非常的简单，我们可以有很多的解决方案: 方案一 直接上mysql...</div>
        </div>
    
        <div class='post'>
            <div class='title'><a href='/2012/08/weibo-counter-service-design-1.html'>[微架构设计]微博计数器的设计(上)</a></div>
            <div class='date'>August 30, 2012 &nbsp &nbsp 
                
                    <a href='/tags.html#tag_计数器'>计数器</a> &nbsp 
                
                    <a href='/tags.html#tag_微架构设计'>微架构设计</a> &nbsp 
                
                    <a href='/tags.html#tag_微博平台架构'>微博平台架构</a> &nbsp 
                
            </div>
            <div class='extract'>正式入职新浪微博一个月了，一切安好，各位勿念。 也多谢各位猎头抬爱，但是请不要再骚扰了，近期完全没有找工作的兴趣。 入职这一个月，虽然大多时间是在熟悉架构的一些细节，但是也深深地感受到了weibo平台巨大的流量和社会影响力(对于服务稳定性提出了近乎苛刻的要求)带给架构师们的巨大挑战和压力，当然这也是几乎每一位架构师都梦寐以求的机会！ 闲话少说，上点干货. 背景: 每一条微博的转发和评论背后都是一串串说不完的故事，但是今天主要讲的是 **计数服务**，计数服务详尽地记录着每条微博 被评论的次数 和 被转发的次数，当然也还有更多的喜怒哀乐都记录于此。 数据量: 微博总数量: 千亿级 而且每秒都在飞速增长中。每条微博都有一个64位的唯一id。 访问量: 每秒百万级 还在稳步增长中。 根据微博的id来访问。 主要接口: 增加评论数 (默认为0) 增加转发数 (默认为0) 获取评论数 获取转发数 获取评论数 + 获取转发数 (这个接口访问量最大) 评论数和转发数，你都可以认为是 32位的整形数值。不会是负数，默认是0。 要求: 由于用户对于数字非常的敏感(想想你好不容易拉到一位粉丝，但是粉丝数没涨的痛苦吧。)，所以我们要求数据非常准确，延迟极低(1s以内)，服务稳定性极高(千万别因为某大妈扫个地拨了插座就把数字弄没了...) 做为架构师，当然也需要全方位地考虑架构成本问题，然后去做各种的折衷。 这里主要考虑的成本是: 机器成本，开发成本，维护成本。 有兴趣的架构师和准架构师们可以一起思考，怎样才能用最少的机器，最短时间内开发出最易维护的计数器系统。。。当然，得满足我们数据量，性能和高可用的要求。 对这一块非常的感兴趣，而且有靠谱的想法和建议，烦请私信简历给 @cydu 或者...</div>
        </div>
    
        <div class='post'>
            <div class='title'><a href='/2012/07/say-goodbye-to-baidu.html'>那些年我们一起写代码--杜传赢和各位说再见</a></div>
            <div class='date'>July 16, 2012 &nbsp &nbsp 
                
                    <a href='/tags.html#tag_百度'>百度</a> &nbsp 
                
                    <a href='/tags.html#tag_离职'>离职</a> &nbsp 
                
                    <a href='/tags.html#tag_再见'>再见</a> &nbsp 
                
                    <a href='/tags.html#tag_感谢'>感谢</a> &nbsp 
                
                    <a href='/tags.html#tag_cydu'>cydu</a> &nbsp 
                
            </div>
            <div class='extract'>Hi，各位亲爱的同事: 今天是我在百度工作的第1469天(别算了, 4年零8天, ^_^)，也是最后一天。 正式向各位道别，并感谢各位老大, 同事的信任和帮助, 祝一切都好。 宇宙很小，有空常联系，有缘多相会! 谢谢 weibo: weibo.com/cydu QQ: 172XXXX36 Baidu hi: hustdcy Mail/Gtalk: hustdcy at gmail.com MSN: hustdcy at hotmail.com =============== 婆婆妈妈，啰啰嗦嗦的分隔线，有事的同学可忽略 =========== 看着950多位百度hi的联系人，和近10万封的工作邮件，一边回想这四年来的无数点点滴滴， 突然变得非常伤感，就像当年从学校毕业送走同学, 再孤身一人来到北京一样的不舍。。。 这四年，是我人生中最值得留恋的四年，因为 在这里，我认识了无数非常牛B却又真诚相待的老大和朋友; 在这里，我有幸参与并见证了百度基础平台/基础架构 萌芽，发展，再到壮大的完整过程; 在这里，我也见证了百度在云计算领域的长远规划和伟大决心; 在这里，我有机会学习，体会并实践着&quot;简单，可依赖&quot;的百度文化; 在这里，我亲身尝试了RD，PM，OP，QA，FE，甚至是UE，售前，售后，客服的各个工种，学习到了各角色所不同的工作方式; 在这里，一个嫩得挤出水来的互联网新兵，变成了一个互联网&quot;老屌丝&quot;---真的已经很老了; 在这里，一个初出茅庐的单身穷小伙也逐步过上了&quot;老婆孩子热坑头&quot;的幸福生活。。。 感谢...</div>
        </div>
    
</ul>
      </div>

      <footer>
        <p>&copy; Cydu 2012 
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
        </p>
      </footer>

    </div> <!-- /container -->

    
  </body>
</html>

